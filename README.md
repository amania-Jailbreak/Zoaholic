# Zoaholic

-   名前: Zoaholic
-   フレームワーク・言語: Node.js, OpenAPI, REST API

## 概要

Zoaholic（本プログラム）は、複数サーバー間で相互に死活監視を行うためのソフトウェアです。  
本ソフトウェアは 4 つのモードで動作します。

-   ホストモード
-   クライアントモード
-   アップデートモード
-   レスキューモード

各モードを切り替えながら運用します。

### ホストモード

WebUI からアクセスでき、クライアントモードのサーバーを統括管理します。  
各サーバーの動作ログやアップデート管理も行います。  
WebSocket サーバー（HOST-WS）が起動し、クライアントからのログ受信や操作を担当します。  
冗長化のため、2 系統の通信経路を用意し、不整合を防ぎます。

### クライアントモード

WebUI は停止し、軽量動作に切り替わります。  
自身のログを収集し、プラグイン用 WebSocket サーバー（PL-WS）が起動します。  
PL-WS はプラグインからのログを整形し、ホストへ送信します。  
クライアントは全情報を HOST-WS へ送信する必要があります。

### アップデートモード

ホストからのアップデート要求で切り替わるモードです。  
アップデート用 WebSocket でホストと接続し、差分を受信して更新します。  
アップデート後、テストが全て PASS すればクライアントモードへ復帰し、結果を UPDATE-WS 経由で通知します。  
失敗時はバックアップから復元し再テスト、復元成功時はその旨を通知します。  
アップデートは 1 台ずつ順次行い、失敗時は管理者へ通知します。  
Android の A/B システムのような復元構造を採用します。

### レスキューモード

設定を初期化し、GitHub の安定版 Release から差分を取得して復元します。  
ホストとの接続設定は初期化しません。  
通常はこのモードに入ることはありません。

### WebUI

Material3 を用いたレスポンシブ UI で、スマホ・PC 両対応です。  
Discord や E メール送信機能を持ち、拡張性のある設計です。

### プラグイン

ホスト用・クライアント用の 2 種類があります。  
ホスト用は管理系、クライアント用は pm2 や Docker 管理などが可能です。  
各プラグインは WebUI に設定メニューを持ち、設定は個別に保存されます。

### バックアップ

ホストが 15 分ごとにバックアップを実施し、指定ディレクトリとクライアントに分散保存します。  
これによりデータ消失を防ぎます。
